@namespace LionFire.OpenCode.Blazor.Components.Shared

<div class="error-state @Class">
    <div class="error-state-icon">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/>
            <path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
    </div>

    <h3 class="error-state-title">@Title</h3>

    @if (!string.IsNullOrEmpty(Description))
    {
        <p class="error-state-description">@Description</p>
    }

    @if (!string.IsNullOrEmpty(Details) && ShowDetails)
    {
        <div class="error-state-details">
            <button class="details-toggle" @onclick="ToggleDetails">
                @(IsDetailsExpanded ? "Hide details" : "Show details")
                <svg class="toggle-icon @(IsDetailsExpanded ? "expanded" : "")" viewBox="0 0 20 20" fill="none">
                    <path d="M6.6665 8.33325L9.99984 11.6666L13.3332 8.33325" stroke="currentColor" stroke-linecap="square"/>
                </svg>
            </button>
            @if (IsDetailsExpanded)
            {
                <pre class="details-content">@Details</pre>
            }
        </div>
    }

    <div class="error-state-actions">
        @if (OnRetry.HasDelegate)
        {
            <button class="retry-button" @onclick="HandleRetry" disabled="@IsRetrying">
                @if (IsRetrying)
                {
                    <span class="retry-spinner"></span>
                    <span>Retrying...</span>
                }
                else
                {
                    <svg viewBox="0 0 24 24" fill="none" class="retry-icon">
                        <path d="M1 4v6h6M23 20v-6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>@RetryText</span>
                }
            </button>
        }
        @if (SecondaryAction != null)
        {
            @SecondaryAction
        }
    </div>
</div>

@code {
    [Parameter] public string Title { get; set; } = "Something went wrong";
    [Parameter] public string? Description { get; set; }
    [Parameter] public string? Details { get; set; }
    [Parameter] public bool ShowDetails { get; set; } = true;
    [Parameter] public string RetryText { get; set; } = "Try again";
    [Parameter] public EventCallback OnRetry { get; set; }
    [Parameter] public RenderFragment? SecondaryAction { get; set; }
    [Parameter] public string? Class { get; set; }

    private bool IsDetailsExpanded { get; set; }
    private bool IsRetrying { get; set; }

    private void ToggleDetails()
    {
        IsDetailsExpanded = !IsDetailsExpanded;
    }

    private async Task HandleRetry()
    {
        if (IsRetrying) return;

        IsRetrying = true;
        StateHasChanged();

        try
        {
            await OnRetry.InvokeAsync();
        }
        finally
        {
            IsRetrying = false;
            StateHasChanged();
        }
    }
}

<style>
    .error-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 48px 24px;
        text-align: center;
    }

    .error-state-icon {
        width: 48px;
        height: 48px;
        margin-bottom: 16px;
        color: var(--icon-critical-base);
    }

    .error-state-icon svg {
        width: 100%;
        height: 100%;
    }

    .error-state-title {
        font-size: var(--font-size-large);
        font-weight: var(--font-weight-medium);
        color: var(--text-base);
        margin: 0 0 8px 0;
    }

    .error-state-description {
        font-size: var(--font-size-base);
        color: var(--text-weak);
        margin: 0;
        max-width: 400px;
        line-height: 1.5;
    }

    .error-state-details {
        margin-top: 16px;
        width: 100%;
        max-width: 500px;
    }

    .details-toggle {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        background: none;
        border: none;
        color: var(--text-interactive-base);
        font-size: var(--font-size-small);
        cursor: pointer;
        padding: 4px 8px;
        border-radius: var(--radius-sm);
    }

    .details-toggle:hover {
        background: var(--surface-base-hover);
    }

    .toggle-icon {
        width: 16px;
        height: 16px;
        transition: transform 0.2s;
    }

    .toggle-icon.expanded {
        transform: rotate(180deg);
    }

    .details-content {
        margin-top: 8px;
        padding: 12px;
        background: var(--surface-inset-base);
        border-radius: var(--radius-md);
        font-family: var(--font-family-mono);
        font-size: var(--font-size-xs);
        color: var(--text-weak);
        text-align: left;
        white-space: pre-wrap;
        word-break: break-word;
        max-height: 200px;
        overflow-y: auto;
    }

    .error-state-actions {
        display: flex;
        gap: 12px;
        margin-top: 24px;
    }

    .retry-button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: var(--surface-interactive-base);
        color: var(--text-on-interactive-base);
        border: none;
        border-radius: var(--radius-md);
        font-size: var(--font-size-base);
        font-weight: var(--font-weight-medium);
        cursor: pointer;
        transition: background-color 0.15s;
    }

    .retry-button:hover:not(:disabled) {
        background: var(--surface-interactive-hover);
    }

    .retry-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .retry-icon {
        width: 16px;
        height: 16px;
    }

    .retry-spinner {
        width: 14px;
        height: 14px;
        border: 2px solid currentColor;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @@keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Reduced motion support */
    @@media (prefers-reduced-motion: reduce) {
        .toggle-icon {
            transition: none !important;
        }

        .retry-spinner {
            animation: none !important;
        }
    }
</style>
