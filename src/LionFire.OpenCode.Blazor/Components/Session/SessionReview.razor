@namespace LionFire.OpenCode.Blazor.Components.Session

<div class="session-review @Class">
    <div class="session-review-header">
        <h3 class="session-title">@(Title ?? "Session Review")</h3>
        @if (Duration.HasValue)
        {
            <span class="session-duration">@FormatDuration(Duration.Value)</span>
        }
    </div>

    <div class="session-stats-grid">
        <!-- Message Stats -->
        <div class="stat-card">
            <div class="stat-icon">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                </svg>
            </div>
            <div class="stat-content">
                <span class="stat-value">@TotalMessages</span>
                <span class="stat-label">Messages</span>
            </div>
            <div class="stat-breakdown">
                <span class="stat-detail">@UserMessages user</span>
                <span class="stat-detail">@AssistantMessages assistant</span>
            </div>
        </div>

        <!-- File Operations -->
        <div class="stat-card">
            <div class="stat-icon">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                </svg>
            </div>
            <div class="stat-content">
                <span class="stat-value">@TotalFileOps</span>
                <span class="stat-label">File Ops</span>
            </div>
            <div class="stat-breakdown">
                <span class="stat-detail">@FilesRead read</span>
                <span class="stat-detail">@FilesWritten written</span>
                <span class="stat-detail">@FilesEdited edited</span>
            </div>
        </div>

        <!-- Tool Usage -->
        <div class="stat-card">
            <div class="stat-icon">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/>
                </svg>
            </div>
            <div class="stat-content">
                <span class="stat-value">@TotalToolCalls</span>
                <span class="stat-label">Tool Calls</span>
            </div>
            <div class="stat-breakdown">
                <span class="stat-detail">@BashCommands bash</span>
                <span class="stat-detail">@Searches search</span>
                <span class="stat-detail">@WebFetches web</span>
            </div>
        </div>

        <!-- Token Usage (if available) -->
        @if (TokensUsed > 0)
        {
            <div class="stat-card">
                <div class="stat-icon">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-value">@FormatTokens(TokensUsed)</span>
                    <span class="stat-label">Tokens</span>
                </div>
            </div>
        }
    </div>

    @if (ChildContent != null)
    {
        <div class="session-review-extra">
            @ChildContent
        </div>
    }
</div>

@code {
    [Parameter] public string? Title { get; set; }
    [Parameter] public TimeSpan? Duration { get; set; }
    [Parameter] public int UserMessages { get; set; }
    [Parameter] public int AssistantMessages { get; set; }
    [Parameter] public int FilesRead { get; set; }
    [Parameter] public int FilesWritten { get; set; }
    [Parameter] public int FilesEdited { get; set; }
    [Parameter] public int BashCommands { get; set; }
    [Parameter] public int Searches { get; set; }
    [Parameter] public int WebFetches { get; set; }
    [Parameter] public int TokensUsed { get; set; }
    [Parameter] public string? Class { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }

    private int TotalMessages => UserMessages + AssistantMessages;
    private int TotalFileOps => FilesRead + FilesWritten + FilesEdited;
    private int TotalToolCalls => BashCommands + Searches + WebFetches;

    private string FormatDuration(TimeSpan duration)
    {
        if (duration.TotalHours >= 1)
            return $"{(int)duration.TotalHours}h {duration.Minutes}m";
        if (duration.TotalMinutes >= 1)
            return $"{duration.Minutes}m {duration.Seconds}s";
        return $"{duration.Seconds}s";
    }

    private string FormatTokens(int tokens)
    {
        if (tokens >= 1000000)
            return $"{tokens / 1000000.0:F1}M";
        if (tokens >= 1000)
            return $"{tokens / 1000.0:F1}K";
        return tokens.ToString();
    }
}

<style>
    .session-review {
        background: var(--surface-raised-base);
        border-radius: var(--radius-lg);
        padding: 16px;
    }

    .session-review-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border-base);
    }

    .session-title {
        font-size: var(--font-size-large);
        font-weight: var(--font-weight-medium);
        color: var(--text-base);
        margin: 0;
    }

    .session-duration {
        font-size: var(--font-size-small);
        color: var(--text-weaker);
        font-family: var(--font-family-mono);
    }

    .session-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
    }

    .stat-card {
        background: var(--surface-inset-base);
        border-radius: var(--radius-md);
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .stat-icon {
        color: var(--icon-base);
    }

    .stat-content {
        display: flex;
        align-items: baseline;
        gap: 6px;
    }

    .stat-value {
        font-size: var(--font-size-x-large);
        font-weight: var(--font-weight-medium);
        color: var(--text-base);
        font-family: var(--font-family-mono);
    }

    .stat-label {
        font-size: var(--font-size-small);
        color: var(--text-weak);
    }

    .stat-breakdown {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .stat-detail {
        font-size: var(--font-size-xs);
        color: var(--text-weaker);
        font-family: var(--font-family-mono);
    }

    .session-review-extra {
        margin-top: 16px;
        padding-top: 12px;
        border-top: 1px solid var(--border-base);
    }
</style>
